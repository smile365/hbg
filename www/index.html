<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>adb - imgs</title>
</head>
<body>
    <img id="picshow" src="imgs/screen.png" alt="some_text" width="300px">
</body>


<script type="text/javascript">
	// document.getElementById("picshow").src = "imgs/screen.png"
	var url = "http://localhost:8080/api/"
	var img = document.getElementById("picshow")
	async function fetchText() {
	  let res = await fetch(url+"img");
	  let name = await res.text()
	  return name
	}	
	
	
	function handle(){
		fetchText().then((name)=>{
			if (name.length < 20){
				img.src = "imgs/"+name+".png"
				var timer = setInterval(function() {
	                if (img.complete) {
	                    clearInterval(timer)
	                    setTimeout(handle,500)
	                }
            	}, 50)
			}
			
		})
	}
	handle()

	let maxX = 1080
	let maxY = 2340
	let imgX = 300
	let imgY = 650
	function rectClick(event) {
        //获取相对于当前所指向对象的位置坐标

        console.log('click '+'x:' + x + "  y:" +  y);
        
        // adb shell input tap x y
    }
    var x,y
    img.onmousedown = function(e){
    	pauseEvent(e)
    	x = parseInt(e.offsetX/300*1080)
        y = parseInt(e.offsetY/650*2340)
    }

	img.onmouseup = function(e){
		x2 = parseInt(e.offsetX/300*1080)
        y2 = parseInt(e.offsetY/650*2340)
        points = x+ " " + y + " " + x2+ " "+ y2
        console.log(points)
		if (Math.abs(x-x2 )< 10 && Math.abs(y-y2)<10) {
			fetch(url+"click?x="+x+"&y="+y).then(()=>{})
		}else{
			
			fetch(url+"move?points="+points).then(()=>{        })
		}
	}


// //阻止事件冒泡
// //不仅仅要stopPropagation，还要preventDefault
function pauseEvent(e){
    if(e.stopPropagation) e.stopPropagation();
    if(e.preventDefault) e.preventDefault();
    e.cancelBubble=true;
    e.returnValue=false;
    return false;
}


    // document.addEventListener('touchstart', touchStart);
    // // document.addEventListener('touchmove',touchMove);
    // document.addEventListener('touchend',touchEnd);
    // // document.addEventListener('touchcanel',touchCancel);

    // var p1,p2
    // function touchStart(e){
    // 	p1 = e.touches[0]
    // 	console.log(p1.clientX+','+p1.clientY)
    // }

    // function touchEnd(e){
    // 	p2 = e.touches[0]
    // 	console.log(p2.clientX+','+p2.clientY)
    // }






</script>